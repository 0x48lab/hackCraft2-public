<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hackCraft2 - Minecraft Modding Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        .hero {
            background-color: #2c3e50;
            color: white;
            padding: 4rem 0;
            margin-bottom: 2rem;
        }
        .feature-card {
            margin-bottom: 2rem;
            transition: transform 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .download-section {
            background-color: #f8f9fa;
            padding: 3rem 0;
            margin: 2rem 0;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">hackCraft2</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#features">機能</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#download">ダウンロード</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#getting-started">始め方</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero">
        <div class="container text-center">
            <h1 class="display-4">hackCraft2</h1>
            <p class="lead">Minecraftの新しいModdingプラットフォーム</p>
        </div>
    </div>

    <div class="container">
        <section id="features" class="mb-5">
            <h2 class="text-center mb-4">主な機能</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="card feature-card">
                        <div class="card-body">
                            <h5 class="card-title">ビジュアルプログラミング</h5>
                            <p class="card-text">Scratchベースのビジュアルプログラミング環境で、直感的にModを作成できます。</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card">
                        <div class="card-body">
                            <h5 class="card-title">3Dプレビュー</h5>
                            <p class="card-text">作成したModの3Dモデルをリアルタイムでプレビューできます。</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card">
                        <div class="card-body">
                            <h5 class="card-title">コードエディタ</h5>
                            <p class="card-text">高度な機能が必要な場合は、コードエディタで直接プログラミングも可能です。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="download" class="download-section">
            <div class="container">
                <h2 class="text-center mb-4">ダウンロード</h2>
                <div class="row justify-content-center">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="bi bi-stars"></i> 安定版 (Stable)
                                </h5>
                                <p class="card-text">最新の安定版ビルドをダウンロードできます。最も安定した動作が期待できるバージョンです。</p>
                                <div id="stable-release">
                                    <p class="text-muted">リリース情報を読み込み中...</p>
                                </div>
                                <div class="text-end mt-2">
                                    <a href="stable-history.html" class="btn btn-outline-secondary btn-sm">
                                        <i class="bi bi-clock-history"></i> 過去の安定版を表示
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="bi bi-tags"></i> リリース版
                                </h5>
                                <p class="card-text">タグ付きのリリースビルドをダウンロードできます。特定のバージョンが必要な場合にご利用ください。</p>
                                <div id="tagged-releases">
                                    <p class="text-muted">リリース情報を読み込み中...</p>
                                </div>
                                <div class="text-end mt-2">
                                    <a href="release-history.html" class="btn btn-outline-secondary btn-sm">
                                        <i class="bi bi-clock-history"></i> 過去のリリース版を表示
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="getting-started" class="mb-5">
            <h2 class="text-center mb-4">始め方</h2>
            <div class="row">
                <div class="col-md-12 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title">
                                <i class="bi bi-server"></i> サーバーセットアップ手順
                            </h3>
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> この手順では、Paperサーバーを使用することを推奨しています。
                                Paperは高性能で安定したサーバーソフトウェアです。
                            </div>
                            <div class="steps">
                                <h4 class="mt-4">1. Paperサーバーのインストール</h4>
                                <ol>
                                    <li>
                                        <a href="https://papermc.io/downloads" target="_blank">Paperのダウンロードページ</a>から最新版のPaperをダウンロード
                                        <ul>
                                            <li>推奨バージョン: Minecraft 1.24.4(2025年6月10日現在)</li>
                                            <li>ダウンロードしたjarファイルを任意のディレクトリに配置</li>
                                        </ul>
                                    </li>
                                    <li>
                                        サーバーの初期設定
                                        <ul>
                                            <li>jarファイルをダブルクリックして実行（初回起動）</li>
                                            <li><code>eula.txt</code>を開き、<code>eula=true</code>に変更</li>
                                            <li><code>server.properties</code>でサーバー設定を調整（必要に応じて）</li>
                                        </ul>
                                    </li>
                                </ol>

                                <h4 class="mt-4">2. hackCraft2プラグインのインストール</h4>
                                <ol>
                                    <li>
                                        サーバーの<code>plugins</code>フォルダを作成
                                        <ul>
                                            <li>Paperサーバーのルートディレクトリに<code>plugins</code>フォルダを作成</li>
                                        </ul>
                                    </li>
                                    <li>
                                        hackCraft2プラグインの配置
                                        <ul>
                                            <li>上記の「ダウンロード」セクションから安定版またはリリース版をダウンロード</li>
                                            <li>ダウンロードしたjarファイルを<code>plugins</code>フォルダに配置</li>
                                        </ul>
                                    </li>
                                </ol>

                                <h4 class="mt-4">3. サーバーの起動</h4>
                                <ol>
                                    <li>
                                        サーバーの起動
                                        <ul>
                                            <li>Paperのjarファイルを再度実行してサーバーを起動</li>
                                            <li>初回起動時はプラグインの初期化に時間がかかる場合があります</li>
                                        </ul>
                                    </li>
                                    <li>
                                        動作確認
                                        <ul>
                                            <li>サーバーが正常に起動したら、Minecraftクライアントから接続</li>
                                            <li>サーバーコンソールで<code>/plugins</code>コマンドを実行し、hackCraft2が正常に読み込まれていることを確認</li>
                                        </ul>
                                    </li>
                                </ol>

                                <div class="alert alert-warning mt-4">
                                    <h5><i class="bi bi-exclamation-triangle"></i> 注意事項</h5>
                                    <ul class="mb-0">
                                        <li>サーバーのメモリ割り当ては最低4GB以上を推奨</li>
                                        <li>初回起動時は<code>server.properties</code>の<code>online-mode</code>を<code>false</code>に設定することを推奨（開発時）</li>
                                        <li>本番環境では適切なセキュリティ設定を行ってください</li>
                                    </ul>
                                </div>

                                <div class="alert alert-info mt-4">
                                    <h5><i class="bi bi-lightbulb"></i> トラブルシューティング</h5>
                                    <ul class="mb-0">
                                        <li>サーバーが起動しない場合は、Javaのバージョンが17以上であることを確認</li>
                                        <li>プラグインが読み込まれない場合は、jarファイルが正しい<code>plugins</code>フォルダに配置されているか確認</li>
                                        <li>エラーメッセージが表示される場合は、サーバーのログ（<code>logs/latest.log</code>）を確認</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer class="bg-dark text-light py-4">
        <div class="container text-center">
            <p>&copy; 2024 hackCraft2. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 安定版とリリース版の情報を取得
        const fetchWithTimeout = (url, timeout = 5000) => {
            return Promise.race([
                fetch(url).then(response => {
                    if (!response.ok) {
                        throw new Error(`${url}の取得に失敗しました (${response.status})`);
                    }
                    return response.json();
                }),
                new Promise((_, reject) => 
                    setTimeout(() => reject(new Error(`${url}の取得がタイムアウトしました`)), timeout)
                )
            ]);
        };

        const formatReleaseInfo = (release) => {
            if (!release?.assets?.length) {
                return null;
            }

            const asset = release.assets[0];
            const downloadUrl = asset.browser_download_url;
            const fileName = asset.name;
            const fileSize = asset.size && asset.size > 1024 ? `${(asset.size / (1024 * 1024)).toFixed(2)}MB` : '-';
            const releaseDate = release.published_at ? new Date(release.published_at).toLocaleDateString('ja-JP') : '日付情報なし';

            // bodyの処理
            let description = '';
            if (release.body) {
                const lines = release.body.split('\n')
                    .map(line => line.trim())
                    .filter(line => line && !line.startsWith('- Paper Version:'));
                
                if (lines.length > 0) {
                    description = lines[0].replace('タグ付きリリース: ', '');
                }
            }

            // リリース名からPaperのバージョンを推測
            let paperVersion = release.paper_version;
            if (!paperVersion && release.name) {
                const match = release.name.match(/^v(\d+\.\d+\.\d+)/);
                if (match) {
                    paperVersion = match[1];
                }
            }

            return {
                name: release.name || '名前なし',
                description,
                releaseDate,
                paperVersion,
                fileSize,
                downloadUrl,
                fileName
            };
        };

        const updateReleaseInfo = (elementId, data, isStable = false) => {
            const div = document.getElementById(elementId);
            if (!div) return;

            try {
                const release = isStable ? data?.latest : data?.release;
                const info = formatReleaseInfo(release);
                
                if (!info) {
                    div.innerHTML = `<p class="text-muted">${isStable ? '安定版' : 'リリース版'}の情報が見つかりませんでした。</p>`;
                    return;
                }

                div.innerHTML = `
                    <div class="list-group">
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">${info.name}</h6>
                                    ${info.description ? `<p class="mb-1 small text-muted">${info.description}</p>` : ''}
                                </div>
                                <small class="text-muted">${info.releaseDate}</small>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <div>
                                    ${info.paperVersion ? `<span class="badge bg-info me-2">Paper ${info.paperVersion}</span>` : ''}
                                    <small class="text-muted">${info.fileSize}</small>
                                </div>
                                <a href="${info.downloadUrl}" class="btn btn-primary btn-sm" download="${info.fileName}">
                                    <i class="bi bi-download"></i> ダウンロード
                                </a>
                            </div>
                        </div>
                    </div>`;
            } catch (error) {
                console.error(`Error updating ${elementId}:`, error);
                div.innerHTML = `<p class="text-danger"><i class="bi bi-exclamation-triangle"></i> ${error.message || '情報の表示に失敗しました'}</p>`;
            }
        };

        // 各ファイルを個別に取得して表示
        Promise.allSettled([
            fetchWithTimeout('stable.json')
                .then(data => updateReleaseInfo('stable-release', data, true))
                .catch(error => {
                    console.error('Stable release error:', error);
                    document.getElementById('stable-release').innerHTML = 
                        `<p class="text-warning"><i class="bi bi-exclamation-triangle"></i> ${error.message}</p>`;
                }),
            fetchWithTimeout('releases.json')
                .then(data => updateReleaseInfo('tagged-releases', data))
                .catch(error => {
                    console.error('Tagged release error:', error);
                    document.getElementById('tagged-releases').innerHTML = 
                        `<p class="text-warning"><i class="bi bi-exclamation-triangle"></i> ${error.message}</p>`;
                })
        ]).then(results => {
            console.log('All release info updates completed');
        });
    </script>
</body>
</html> 