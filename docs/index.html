<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- キャッシュ制御を強化 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- 自動更新 -->
    <meta http-equiv="refresh" content="300">
    <title>hackCraft2 - Minecraft Modding Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        .hero {
            background-color: #2c3e50;
            color: white;
            padding: 4rem 0;
            margin-bottom: 2rem;
        }
        .feature-card {
            margin-bottom: 2rem;
            transition: transform 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .download-section {
            background-color: #f8f9fa;
            padding: 3rem 0;
            margin: 2rem 0;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">hackCraft2</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#features">機能</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#download">ダウンロード</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#getting-started">始め方</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero">
        <div class="container text-center">
            <h1 class="display-4">hackCraft2</h1>
            <p class="lead">Minecraftの新しいModdingプラットフォーム</p>
        </div>
    </div>

    <div class="container">
        <section id="features" class="mb-5">
            <h2 class="text-center mb-4">主な機能</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="card feature-card">
                        <div class="card-body">
                            <h5 class="card-title">ビジュアルプログラミング</h5>
                            <p class="card-text">Scratchベースのビジュアルプログラミング環境で、直感的にModを作成できます。</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card">
                        <div class="card-body">
                            <h5 class="card-title">3Dプレビュー</h5>
                            <p class="card-text">作成したModの3Dモデルをリアルタイムでプレビューできます。</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card">
                        <div class="card-body">
                            <h5 class="card-title">コードエディタ</h5>
                            <p class="card-text">高度な機能が必要な場合は、コードエディタで直接プログラミングも可能です。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="download" class="download-section">
            <div class="container">
                <h2 class="text-center mb-4">ダウンロード</h2>
                <div class="row justify-content-center">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="bi bi-lightning-charge"></i> 最新ビルド
                                </h5>
                                <p class="card-text">最新の開発ビルドをダウンロードできます。最新の機能や修正が含まれていますが、安定性は保証されません。</p>
                                <div id="latest-build">
                                    <p class="text-muted">ビルド情報を読み込み中...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="bi bi-tags"></i> 安定版リリース
                                </h5>
                                <p class="card-text">タグ付きの安定版リリースをダウンロードできます。テスト済みで安定した動作が期待できるバージョンです。</p>
                                <div id="stable-release">
                                    <p class="text-muted">リリース情報を読み込み中...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="bi bi-clock-history"></i> 過去のリリース
                                </h5>
                                <div id="release-history">
                                    <p class="text-muted">リリース履歴を読み込み中...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="getting-started" class="mb-5">
            <h2 class="text-center mb-4">始め方</h2>
            <div class="row">
                <div class="col-md-12 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title">
                                <i class="bi bi-server"></i> サーバーセットアップ手順
                            </h3>
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> この手順では、Paperサーバーを使用することを推奨しています。
                                Paperは高性能で安定したサーバーソフトウェアです。
                            </div>
                            <div class="steps">
                                <h4 class="mt-4">1. Paperサーバーのインストール</h4>
                                <ol>
                                    <li>
                                        <a href="https://papermc.io/downloads" target="_blank">Paperのダウンロードページ</a>から最新版のPaperをダウンロード
                                        <ul>
                                            <li>推奨バージョン: Minecraft 1.24.4(2025年6月10日現在)</li>
                                            <li>ダウンロードしたjarファイルを任意のディレクトリに配置</li>
                                        </ul>
                                    </li>
                                    <li>
                                        サーバーの初期設定
                                        <ul>
                                            <li>jarファイルをダブルクリックして実行（初回起動）</li>
                                            <li><code>eula.txt</code>を開き、<code>eula=true</code>に変更</li>
                                            <li><code>server.properties</code>でサーバー設定を調整（必要に応じて）</li>
                                        </ul>
                                    </li>
                                </ol>

                                <h4 class="mt-4">2. hackCraft2プラグインのインストール</h4>
                                <ol>
                                    <li>
                                        サーバーの<code>plugins</code>フォルダを作成
                                        <ul>
                                            <li>Paperサーバーのルートディレクトリに<code>plugins</code>フォルダを作成</li>
                                        </ul>
                                    </li>
                                    <li>
                                        hackCraft2プラグインの配置
                                        <ul>
                                            <li>上記の「ダウンロード」セクションから安定版またはリリース版をダウンロード</li>
                                            <li>ダウンロードしたjarファイルを<code>plugins</code>フォルダに配置</li>
                                        </ul>
                                    </li>
                                </ol>

                                <h4 class="mt-4">3. サーバーの起動</h4>
                                <ol>
                                    <li>
                                        サーバーの起動
                                        <ul>
                                            <li>Paperのjarファイルを再度実行してサーバーを起動</li>
                                            <li>初回起動時はプラグインの初期化に時間がかかる場合があります</li>
                                        </ul>
                                    </li>
                                    <li>
                                        動作確認
                                        <ul>
                                            <li>サーバーが正常に起動したら、Minecraftクライアントから接続</li>
                                            <li>サーバーコンソールで<code>/plugins</code>コマンドを実行し、hackCraft2が正常に読み込まれていることを確認</li>
                                        </ul>
                                    </li>
                                </ol>

                                <div class="alert alert-warning mt-4">
                                    <h5><i class="bi bi-exclamation-triangle"></i> 注意事項</h5>
                                    <ul class="mb-0">
                                        <li>サーバーのメモリ割り当ては最低4GB以上を推奨</li>
                                        <li>初回起動時は<code>server.properties</code>の<code>online-mode</code>を<code>false</code>に設定することを推奨（開発時）</li>
                                        <li>本番環境では適切なセキュリティ設定を行ってください</li>
                                    </ul>
                                </div>

                                <div class="alert alert-info mt-4">
                                    <h5><i class="bi bi-lightbulb"></i> トラブルシューティング</h5>
                                    <ul class="mb-0">
                                        <li>サーバーが起動しない場合は、Javaのバージョンが17以上であることを確認</li>
                                        <li>プラグインが読み込まれない場合は、jarファイルが正しい<code>plugins</code>フォルダに配置されているか確認</li>
                                        <li>エラーメッセージが表示される場合は、サーバーのログ（<code>logs/latest.log</code>）を確認</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer class="bg-dark text-light py-4">
        <div class="container text-center">
            <p>&copy; 2024 hackCraft2. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // キャッシュを無効化してデータを取得する共通関数
        const fetchWithTimeout = (url, timeout = 5000) => {
            return Promise.race([
                fetch(url, {
                    cache: 'no-store',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                }).then(response => {
                    if (!response.ok) {
                        throw new Error(`${url}の取得に失敗しました (${response.status})`);
                    }
                    return response.json();
                }),
                new Promise((_, reject) =>
                    setTimeout(() => reject(new Error(`${url}の取得がタイムアウトしました`)), timeout)
                )
            ]);
        };

        const formatReleaseInfo = (release) => {
            if (!release?.assets?.length) {
                return null;
            }

            const jarAsset = release.assets.find(asset => asset.name.endsWith('.jar'));
            if (!jarAsset) {
                return null;
            }

            const downloadUrl = jarAsset.browser_download_url;
            const fileName = jarAsset.name;
            const fileSize = jarAsset.size ? `${(jarAsset.size / (1024 * 1024)).toFixed(2)}MB` : '-';
            const releaseDate = release.published_at ? new Date(release.published_at).toLocaleDateString('ja-JP') : '日付情報なし';
            const downloadCount = jarAsset.download_count || 0;

            // リリースタイプの判定
            const isStableRelease = release.tag_name.startsWith('v');
            const version = isStableRelease ? 
                release.tag_name.substring(1) : // v1.2.3 -> 1.2.3
                release.tag_name;

            return {
                name: release.name || release.tag_name,
                tag_name: release.tag_name,
                version: version,
                description: release.body || '',
                releaseDate,
                fileSize,
                downloadUrl,
                fileName,
                downloadCount,
                isStableRelease,
                buildDate: release.published_at ? new Date(release.published_at) : null
            };
        };

        const createReleaseCard = (info) => {
            if (!info) return '';

            const description = info.description
                .split('\n')
                .filter(line => line.trim() && !line.startsWith('- Paper Version:'))
                .slice(0, 2)
                .join('<br>');

            const badgeClass = info.isStableRelease ? 'bg-success' : 'bg-warning';
            const badgeText = info.isStableRelease ? `v${info.version}` : '最新ビルド';

            return `
                <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">
                                ${info.name}
                                <span class="badge ${badgeClass} ms-2">${badgeText}</span>
                            </h6>
                            ${description ? `<p class="mb-1 small text-muted">${description}</p>` : ''}
                        </div>
                        <small class="text-muted">${info.releaseDate}</small>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <div>
                            <small class="text-muted">${info.fileSize}</small>
                            <small class="text-muted ms-2">
                                <i class="bi bi-download"></i> ${info.downloadCount.toLocaleString()}
                            </small>
                        </div>
                        <a href="${info.downloadUrl}" class="btn btn-primary btn-sm" download="${info.fileName}">
                            <i class="bi bi-download"></i> ダウンロード
                        </a>
                    </div>
                </div>`;
        };

        const updateReleaseInfo = async () => {
            try {
                const stableData = await fetchWithTimeout('stable.json');
                const latestStable = stableData.latest;

                // 安定版リリースの表示を更新
                const stableReleaseDiv = document.getElementById('stable-release');
                if (latestStable) {
                    const info = {
                        name: latestStable.name,
                        tag_name: `stable-${latestStable.commit_hash}`,
                        version: latestStable.commit_hash,
                        description: latestStable.body,
                        releaseDate: new Date(latestStable.published_at).toLocaleDateString('ja-JP'),
                        fileSize: latestStable.assets[0].size ? `${(latestStable.assets[0].size / (1024 * 1024)).toFixed(2)}MB` : '-',
                        downloadUrl: latestStable.assets[0].browser_download_url,
                        fileName: latestStable.assets[0].name,
                        downloadCount: 0,
                        isStableRelease: true,
                        buildDate: new Date(latestStable.published_at)
                    };

                    stableReleaseDiv.innerHTML = `
                        <div class="list-group">
                            ${createReleaseCard(info)}
                        </div>`;
                } else {
                    stableReleaseDiv.innerHTML = '<p class="text-muted">安定版リリースの情報が見つかりませんでした。</p>';
                }

                // 最新ビルドとリリース履歴は一旦非表示
                document.getElementById('latest-build').innerHTML = '<p class="text-muted">最新ビルドの情報は現在準備中です。</p>';
                document.getElementById('release-history').innerHTML = '<p class="text-muted">過去のリリース情報は現在準備中です。</p>';

            } catch (error) {
                console.error('リリース情報の更新に失敗しました:', error);
                ['latest-build', 'stable-release', 'release-history'].forEach(id => {
                    const div = document.getElementById(id);
                    if (div) {
                        div.innerHTML = `
                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle"></i> リリース情報の取得に失敗しました
                            </div>`;
                    }
                });
            }
        };

        // ページ読み込み時にリリース情報を表示
        document.addEventListener('DOMContentLoaded', () => {
            updateReleaseInfo();
            // 5分ごとに自動更新
            setInterval(updateReleaseInfo, 300000);
        });
    </script>
</body>
</html> 